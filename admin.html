<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ScaleShield — Admin Panel</title>

<style>
:root{
  --bg:#07080B;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --gold:#D6B15E;
  --gold2:#F2D27A;
  --text:#fff;
  --muted:rgba(255,255,255,.65);
  --radius:18px;
  --ease:cubic-bezier(.2,.8,.2,1);
  --danger:#ff6b6b;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:
    radial-gradient(900px circle at 50% -20%, rgba(214,177,94,.16), transparent 55%),
    radial-gradient(800px circle at 85% 5%, rgba(56,189,248,.08), transparent 60%),
    linear-gradient(135deg,#050507,#0b0d14,#090a10);
  color:var(--text);
  padding:28px 16px 90px;
}
.wrap{max-width:1200px;margin:0 auto}
.top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:18px}
.brand{font-weight:950;font-size:20px}
.brand span{
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  -webkit-background-clip:text;background-clip:text;color:transparent;
}
.btn{
  padding:10px 14px;border-radius:14px;font-weight:900;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.05);
  color:#fff;
  transition:.25s var(--ease);
  cursor:pointer;
}
.btn:hover{transform:translateY(-1px);border-color:rgba(214,177,94,.35)}
.btn-primary{
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#111;border-color:transparent;
}
.btn-danger{
  border-color:rgba(255,107,107,.35);
  background:rgba(255,107,107,.12);
}
.grid{display:grid;gap:14px}
@media(min-width:980px){ .grid{grid-template-columns: 1fr 1.2fr} }
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
}
h1{font-size:24px;font-weight:950}
.p{margin-top:8px;color:var(--muted);line-height:1.6}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
label{font-size:12px;font-weight:950;letter-spacing:.16em;text-transform:uppercase;color:rgba(255,255,255,.55)}
input, select{
  width:100%;
  padding:12px;border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.25);
  color:#fff;
}
.form{display:grid;gap:10px;margin-top:12px}
.hr{height:1px;background:rgba(255,255,255,.08);margin:14px 0}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;text-align:left}
th{
  font-size:12px;
  letter-spacing:.16em;
  text-transform:uppercase;
  color:rgba(255,255,255,.55);
  border-bottom:1px solid rgba(255,255,255,.10);
}
tr{border-bottom:1px solid rgba(255,255,255,.06)}
.toast{
  position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
  background:rgba(0,0,0,.65);
  padding:10px 12px;border-radius:999px;
  font-weight:900;font-size:12px;
  opacity:0;transition:.25s var(--ease);
}
.toast.show{opacity:1}
.hide{display:none}
.actions{display:flex;gap:8px}
</style>
</head>
<body>

<div class="wrap">
<div class="top">
<div class="brand"><span>ScaleShield</span> — Admin</div>
<div class="row">
<button class="btn" id="btnLogout">Log out</button>
</div>
</div>

<div class="card" id="loginCard">
<h1>Admin Login</h1>
<form class="form" id="loginForm">
<input id="adminUser" placeholder="Username" required />
<input id="adminPass" type="password" placeholder="Password" required />
<button class="btn btn-primary">Log in</button>
</form>
<div class="p" id="loginErr" style="color:#ff6b6b;display:none"></div>
</div>

<div class="grid hide" id="panel">

<!-- CLIENTS -->
<div class="card">
<h1>Clients</h1>
<div class="hr"></div>

<table>
<thead>
<tr>
<!-- ID COLUMN REMOVED -->
<th>Name</th>
<th>Login</th>
<th>Package</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="clientsRows"></tbody>
</table>

</div>

<!-- AD ACCOUNTS -->
<div class="card">
<h1>Ad Accounts</h1>
<div class="hr"></div>

<label>Select Client</label>
<select id="clientSelect"></select>

<div class="hr"></div>

<table>
<thead>
<tr>
<!-- ID COLUMN REMOVED -->
<th>Ad Name</th>
<th>Ad ID</th>
<th>BM ID</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="adsRows"></tbody>
</table>

</div>

</div>
</div>

<div class="toast" id="toast">Saved</div>

<script>
const API="https://scaleshield-api.lively-sunset-0c93.workers.dev";
const TOKEN_KEY="ss_admin_token";

const toast=document.getElementById("toast");
function showToast(t){toast.textContent=t;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),1200);}

function getToken(){return localStorage.getItem(TOKEN_KEY)||"";}
function setToken(t){localStorage.setItem(TOKEN_KEY,t);}
function clearToken(){localStorage.removeItem(TOKEN_KEY);}

async function api(path,opts={}){
const headers=opts.headers||{};
if(getToken()) headers.Authorization="Bearer "+getToken();
return fetch(API+path,{...opts,headers});
}

function showPanel(){document.getElementById("loginCard").classList.add("hide");document.getElementById("panel").classList.remove("hide");}
function showLogin(){document.getElementById("panel").classList.add("hide");document.getElementById("loginCard").classList.remove("hide");}

document.getElementById("btnLogout").onclick=()=>{clearToken();showLogin();};

document.getElementById("loginForm").onsubmit=async e=>{
e.preventDefault();
const r=await fetch(API+"/admin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:adminUser.value,password:adminPass.value})});
const d=await r.json();
if(!r.ok){loginErr.textContent=d.error||"Login failed";loginErr.style.display="block";return;}
setToken(d.token);
showPanel();
loadClients();
};

async function loadClients(){
const r=await api("/clients");
const d=await r.json();
if(!r.ok)return;
clientsRows.innerHTML="";
clientSelect.innerHTML="";
(d.clients||[]).forEach(c=>{
clientsRows.innerHTML+=`
<tr>
<td>${c.name}</td>
<td>${c.login}</td>
<td>${c.package_name||""}</td>
<td>
<button class="btn btn-danger" onclick="deleteClient(${c.id})">Delete</button>
</td>
</tr>`;
clientSelect.innerHTML+=`<option value="${c.id}">${c.name}</option>`;
});
loadAds();
}

async function deleteClient(id){
if(!confirm("Delete client?"))return;
await api("/clients?id="+id,{method:"DELETE"});
loadClients();
showToast("Client deleted");
}

async function loadAds(){
const id=clientSelect.value;
if(!id)return;
const r=await api("/ad-accounts?client_id="+id);
const d=await r.json();
if(!r.ok)return;
adsRows.innerHTML="";
(d.adAccounts||[]).forEach(a=>{
adsRows.innerHTML+=`
<tr>
<td>${a.ad_name}</td>
<td>${a.ad_id}</td>
<td>${a.bm_id}</td>
<td>
<button class="btn btn-danger" onclick="deleteAd(${a.id})">Delete</button>
</td>
</tr>`;
});
}

async function deleteAd(id){
if(!confirm("Delete ad account?"))return;
await api("/ad-accounts?id="+id,{method:"DELETE"});
loadAds();
showToast("Ad deleted");
}

clientSelect.onchange=loadAds;
</script>
</body>
</html>
